{% extends "base.html" %}
{% block title %}{{ wine.name }} - ManageYourCellar.com{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ wine.vintage or 'NV' }} {{ wine.name }}{% if wine.size_ml and wine.size_ml != 750 %} ({{ wine.size_display }}){% endif %}</h1>
</div>

<div class="action-links">
    {% if wine.status == 'cellar' %}
    <form method="POST" action="{{ url_for('consume_wine', wine_id=wine.id) }}" style="display:inline;" onsubmit="return confirm('Mark a bottle as consumed?')">
        <button type="submit" class="btn btn-success btn-sm">Drink a Bottle</button>
    </form>
    {% endif %}
    <a href="{{ url_for('edit_wine', wine_id=wine.id) }}" class="btn btn-secondary btn-sm">Edit</a>
    <a href="{{ url_for('add_tasting_note', wine_id=wine.id) }}" class="btn btn-secondary btn-sm">+ Tasting Note</a>
    <form method="POST" action="{{ url_for('delete_wine', wine_id=wine.id) }}" style="display:inline;" onsubmit="return confirm('Delete this wine permanently?')">
        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
    </form>
</div>

<!-- Wine Information -->
<div class="section-title"><b>Wine Information</b></div>
<table class="detail-table">
    <tr><td class="label-cell">Name:</td><td>{{ wine.name }}</td><td class="label-cell">Vintage:</td><td>{{ wine.vintage or 'NV' }}</td></tr>
    <tr><td class="label-cell">Producer:</td><td>{{ wine.producer }}</td><td class="label-cell">Type/Color:</td><td>{{ wine.wine_type }}</td></tr>
    <tr><td class="label-cell">Appellation:</td><td colspan="3">{{ wine.appellation or '' }}</td></tr>
    <tr><td class="label-cell">Varietal 1:</td><td>{{ wine.varietal1 or '' }}</td><td class="label-cell">Varietal 2:</td><td>{{ wine.varietal2 or '' }}</td></tr>
    <tr><td class="label-cell">Varietal 3:</td><td>{{ wine.varietal3 or '' }}</td><td class="label-cell">Varietal 4:</td><td>{{ wine.varietal4 or '' }}</td></tr>
    <tr><td class="label-cell">Size (ml):</td><td>{{ wine.size_ml or 750 }}</td><td class="label-cell">Alcohol %:</td><td>{{ "%.1f"|format(wine.alcohol_pct) if wine.alcohol_pct else '' }}</td></tr>
    {% if wine.description %}<tr><td class="label-cell">Description:</td><td colspan="3">{{ wine.description }}</td></tr>{% endif %}
</table>

<!-- Acquisition Information -->
<div class="section-title" style="margin-top:6px;"><b>Acquisition Information</b></div>
<table class="detail-table">
    <tr><td class="label-cell">Date:</td><td>{{ wine.acq_date.strftime('%b %d, %Y') if wine.acq_date else '' }}</td><td class="label-cell">Quantity:</td><td>{{ wine.quantity }}</td></tr>
    <tr><td class="label-cell">Price:</td><td>{% if wine.price %}${{ "%.2f"|format(wine.price) }}{% endif %}</td><td class="label-cell">From:</td><td>{{ wine.acq_from or '' }}</td></tr>
    <tr><td class="label-cell">On Order:</td><td>{{ 'Yes' if wine.on_order else 'No' }}</td><td class="label-cell">Stored:</td><td>{{ wine.stored or '' }}</td></tr>
    {% if wine.acq_description %}<tr><td class="label-cell">Description:</td><td colspan="3">{{ wine.acq_description }}</td></tr>{% endif %}
</table>

<!-- Cellar Tracking -->
<div class="section-title" style="margin-top:6px;"><b>Cellar Tracking</b></div>
<table class="detail-table">
    <tr>
        <td class="label-cell">Status:</td>
        <td>{% if wine.status == 'cellar' %}In Cellar{% elif wine.status == 'consumed' %}Consumed{% if wine.date_consumed %} ({{ wine.date_consumed.strftime('%b %d, %Y') }}){% endif %}{% elif wine.status == 'wishlist' %}Wish List{% endif %}</td>
        <td class="label-cell">Rating:</td>
        <td>{% if wine.rating %}<span class="wine-tag rating">{{ wine.rating }}/100</span>{% endif %}</td>
    </tr>
    <tr>
        <td class="label-cell">Drink Window:</td>
        <td>{{ wine.drinking_window_display }}{% if wine.is_ready_to_drink and wine.status == 'cellar' %} <span class="wine-tag ready">Ready!</span>{% endif %}</td>
        <td class="label-cell">Added:</td>
        <td>{{ wine.date_added.strftime('%b %d, %Y') if wine.date_added else '' }}</td>
    </tr>
</table>

<!-- Tasting Notes -->
<div class="section-title" style="margin-top:6px;"><b>Tasting Notes</b> &mdash; <a href="{{ url_for('add_tasting_note', wine_id=wine.id) }}" style="font-size:10px;">Add Note</a></div>
{% if tasting_notes %}
{% for note in tasting_notes %}
<div class="tasting-card">
    <div class="tasting-header">
        <span class="tasting-date">{{ note.tasting_date.strftime('%B %d, %Y') if note.tasting_date else 'No date' }}</span>
        {% if note.score %}<span class="tasting-score">{{ note.score }} pts</span>{% endif %}
    </div>
    {% if note.appearance %}<div class="tasting-section"><span class="tasting-label">Appearance:</span> <span class="tasting-text">{{ note.appearance }}</span></div>{% endif %}
    {% if note.nose %}<div class="tasting-section"><span class="tasting-label">Nose:</span> <span class="tasting-text">{{ note.nose }}</span></div>{% endif %}
    {% if note.palate %}<div class="tasting-section"><span class="tasting-label">Palate:</span> <span class="tasting-text">{{ note.palate }}</span></div>{% endif %}
    {% if note.finish %}<div class="tasting-section"><span class="tasting-label">Finish:</span> <span class="tasting-text">{{ note.finish }}</span></div>{% endif %}
    {% if note.overall %}<div class="tasting-section"><span class="tasting-label">Overall:</span> <span class="tasting-text">{{ note.overall }}</span></div>{% endif %}
</div>
{% endfor %}
{% else %}
<p style="padding:4px;color:#707070;">No tasting notes yet. <a href="{{ url_for('add_tasting_note', wine_id=wine.id) }}">Add one!</a></p>
{% endif %}
{% endblock %}
